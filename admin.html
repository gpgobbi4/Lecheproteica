<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administración - Precios</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;600&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-brown: #5C3A2E; 
            --secondary-brown: #7A4E3F; 
            --cream: #F5EFE1; 
            --gold: #D4AF37; 
            --text-dark: #333;
            --text-light: #fff;
            --shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--cream);
            color: var(--text-dark);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            width: 90%;
            max-width: 900px;
            background-color: var(--text-light);
            padding: 30px;
            border-radius: 10px;
            box-shadow: var(--shadow);
        }

        h1 {
            font-family: 'Oswald', sans-serif;
            color: var(--primary-brown);
            text-align: center;
            margin-bottom: 30px;
        }

        /* LOGIN FORM */
        .login-form {
            max-width: 350px;
            margin: 50px auto;
            padding: 30px;
            border: 1px solid #ddd;
            border-radius: 8px;
            text-align: center;
        }

        .login-form input {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }

        .login-form button {
            background-color: var(--primary-brown);
            color: var(--text-light);
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 700;
            width: 100%;
            transition: background-color 0.3s;
        }

        .login-form button:hover {
            background-color: var(--secondary-brown);
        }

        /* ADMIN CONTENT */
        #admin-content {
            display: none;
        }

        .price-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .flavor-group {
            border: 1px solid #e0e0e0;
            padding: 15px;
            border-radius: 8px;
            background-color: #f9f9f9;
        }

        .flavor-group h3 {
            font-family: 'Oswald', sans-serif;
            color: var(--gold);
            margin-top: 0;
            border-bottom: 2px solid var(--gold);
            padding-bottom: 5px;
        }

        .price-input {
            margin-bottom: 15px;
        }

        .price-input label {
            display: block;
            font-size: 0.9rem;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .price-input input {
            width: calc(100% - 10px);
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .save-btn {
            background-color: var(--gold);
            color: var(--primary-brown);
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 700;
            margin-top: 20px;
            width: 100%;
            transition: background-color 0.3s;
        }

        .save-btn:hover {
            background-color: #FFC300;
        }
        
        .logout-btn {
            background-color: #E74C3C;
            color: var(--text-light);
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 700;
            margin-top: 20px;
            float: right;
            transition: background-color 0.3s;
        }

        .logout-btn:hover {
            background-color: #C0392B;
        }

        .message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            font-weight: 700;
            display: none;
        }

        .error {
            background-color: #F8D7DA;
            color: #721C24;
            border: 1px solid #F5C6CB;
        }

        .success {
            background-color: #D4EDDA;
            color: #155724;
            border: 1px solid #C3E6CB;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Panel de Administración de Precios</h1>

        <div id="login-section">
            <form class="login-form">
                <h2>Acceso de Administrador</h2>
                <input type="text" id="username" placeholder="Usuario (Guillermo - Indistinto May/Min)" required>
                <input type="password" id="password" placeholder="Contraseña (Lisandro - Distinto May/Min)" required>
                <button type="button" onclick="login()">Ingresar</button>
                <div id="login-message" class="message error"></div>
            </form>
        </div>

        <div id="admin-content">
            <button class="logout-btn" onclick="logout()">Cerrar Sesión</button>
            <h2>Editar Precios de Productos</h2>
            <p>Modifica los precios y haz clic en "Guardar Cambios" para actualizar la tienda en vivo.</p>

            <div class="price-grid">
                </div>

            <button class="save-btn" onclick="savePrices()">Guardar Cambios</button>
            <div id="save-message" class="message success"></div>
        </div>
    </div>

    <script>
        // --- CONSTANTES DE CREDENCIALES ACTUALIZADAS ---
        const ADMIN_USER = 'guillermo'; // Guardado en minúsculas para comparación case-insensitive
        const ADMIN_PASS = 'Lisandro'; // Guardado con mayúscula inicial para comparación case-sensitive
        
        const LOGIN_SECTION = document.getElementById('login-section');
        const ADMIN_CONTENT = document.getElementById('admin-content');
        const LOGIN_MESSAGE = document.getElementById('login-message');
        const SAVE_MESSAGE = document.getElementById('save-message');

        // Estructura de precios por defecto (debe coincidir con index.html)
        const DEFAULT_PRICES_DATA = [
            { flavor: 'Café con Leche', code: 'cafe', presentations: [
                { id: 'pres-cafe-500gr', size: '500 gr', defaultPrice: 15.99 },
                { id: 'pres-cafe-1kg', size: '1 kg', defaultPrice: 28.99 },
                { id: 'pres-cafe-2kg', size: '2 kg', defaultPrice: 54.99 }
            ]},
            { flavor: 'Chocolate', code: 'choc', presentations: [
                { id: 'pres-choc-500gr', size: '500 gr', defaultPrice: 16.99 },
                { id: 'pres-choc-1kg', size: '1 kg', defaultPrice: 29.99 },
                { id: 'pres-choc-2kg', size: '2 kg', defaultPrice: 56.99 }
            ]},
            { flavor: 'Frutilla', code: 'frut', presentations: [
                { id: 'pres-frut-500gr', size: '500 gr', defaultPrice: 15.49 },
                { id: 'pres-frut-1kg', size: '1 kg', defaultPrice: 27.99 },
                { id: 'pres-frut-2kg', size: '2 kg', defaultPrice: 52.99 }
            ]},
            { flavor: 'Frutos Rojos', code: 'frroj', presentations: [
                { id: 'pres-frroj-500gr', size: '500 gr', defaultPrice: 16.49 },
                { id: 'pres-frroj-1kg', size: '1 kg', defaultPrice: 29.49 },
                { id: 'pres-frroj-2kg', size: '2 kg', defaultPrice: 55.99 }
            ]},
            { flavor: 'Capuccino', code: 'capu', presentations: [
                { id: 'pres-capu-500gr', size: '500 gr', defaultPrice: 16.99 },
                { id: 'pres-capu-1kg', size: '1 kg', defaultPrice: 29.99 },
                { id: 'pres-capu-2kg', size: '2 kg', defaultPrice: 56.99 }
            ]}
        ];

        let currentPrices = [];

        // --- FUNCIONES ---

        function showMessage(element, message, type) {
            element.textContent = message;
            element.className = `message ${type}`;
            element.style.display = 'block';
            setTimeout(() => {
                element.style.display = 'none';
            }, 3000);
        }

        function loadPrices() {
            const storedPrices = localStorage.getItem('productPrices');
            
            // Si hay precios almacenados, úsalos. Si no, usa los por defecto.
            if (storedPrices) {
                try {
                    currentPrices = JSON.parse(storedPrices);
                } catch (e) {
                    currentPrices = DEFAULT_PRICES_DATA.flatMap(f => f.presentations.map(p => ({ id: p.id, price: p.defaultPrice })));
                }
            } else {
                currentPrices = DEFAULT_PRICES_DATA.flatMap(f => f.presentations.map(p => ({ id: p.id, price: p.defaultPrice })));
            }
        }

        function getPrice(id) {
            const item = currentPrices.find(p => p.id === id);
            return item ? item.price : 0;
        }

        function renderAdminPanel() {
            const priceGrid = document.querySelector('.price-grid');
            priceGrid.innerHTML = '';
            
            DEFAULT_PRICES_DATA.forEach(flavor => {
                let htmlContent = `<h3>${flavor.flavor}</h3>`;
                
                flavor.presentations.forEach(pres => {
                    const currentPrice = getPrice(pres.id);
                    htmlContent += `
                        <div class="price-input">
                            <label for="${pres.id}">${pres.size} ($)</label>
                            <input type="number" id="${pres.id}" value="${currentPrice.toFixed(2)}" step="0.01" min="0.01" required>
                        </div>
                    `;
                });
                
                priceGrid.innerHTML += `<div class="flavor-group">${htmlContent}</div>`;
            });
        }

        function login() {
            // Convierte el input del usuario a minúsculas
            const user = document.getElementById('username').value.toLowerCase(); 
            const pass = document.getElementById('password').value;

            // Compara: user (lowercase) vs ADMIN_USER (lowercase) Y pass (case-sensitive) vs ADMIN_PASS (case-sensitive)
            if (user === ADMIN_USER && pass === ADMIN_PASS) {
                localStorage.setItem('adminLoggedIn', 'true');
                LOGIN_SECTION.style.display = 'none';
                ADMIN_CONTENT.style.display = 'block';
                renderAdminPanel();
            } else {
                showMessage(LOGIN_MESSAGE, 'Usuario o contraseña incorrectos.', 'error');
            }
        }

        function savePrices() {
            const inputs = document.querySelectorAll('.price-grid input');
            let newPrices = [];
            let allValid = true;

            inputs.forEach(input => {
                const price = parseFloat(input.value);
                if (isNaN(price) || price <= 0) {
                    allValid = false;
                    input.style.border = '2px solid #E74C3C'; // Resaltar error
                } else {
                    input.style.border = '1px solid #ccc';
                    newPrices.push({ id: input.id, price: price });
                }
            });

            if (allValid) {
                localStorage.setItem('productPrices', JSON.stringify(newPrices));
                currentPrices = newPrices; // Actualizar el estado local
                showMessage(SAVE_MESSAGE, '¡Precios guardados correctamente!', 'success');
            } else {
                showMessage(SAVE_MESSAGE, 'Corrige los precios inválidos (deben ser mayores a 0).', 'error');
            }
        }

        function logout() {
            localStorage.removeItem('adminLoggedIn');
            window.location.reload(); 
        }

        // --- INICIALIZACIÓN ---

        document.addEventListener('DOMContentLoaded', () => {
            loadPrices(); // Cargar precios al inicio

            if (localStorage.getItem('adminLoggedIn') === 'true') {
                LOGIN_SECTION.style.display = 'none';
                ADMIN_CONTENT.style.display = 'block';
                renderAdminPanel();
            } else {
                LOGIN_SECTION.style.display = 'block';
                ADMIN_CONTENT.style.display = 'none';
            }
        });
        
        // --- FUNCIONALIDAD: LOGIN CON ENTER ---
        
        document.getElementById('password').addEventListener('keypress', function(e) {
            // Verifica si la tecla presionada es 'Enter'
            if (e.key === 'Enter') {
                e.preventDefault(); 
                login();
            }
        });
        
        document.getElementById('username').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                login();
            }
        });
        
        if (localStorage.getItem('adminLoggedIn') !== 'true') {
            document.getElementById('username').focus();
        }
    </script>
</body>
</html>